import h5py

index_file = "../mesa-x/mesa_subject_index.h5"

SLEEPPPG_TEST_SUBJECTS = [
    "0001","0021","0033","0052","0077","0081","0101","0111","0225","0310",
    "0314","0402","0416","0445","0465","0483","0505","0554","0572","0587",
    "0601","0620","0648","0702","0764","0771","0792","0797","0800","0807",
    "0860","0892","0902","0904","0921","1033","1080","1121","1140","1148",
    "1161","1164","1219","1224","1271","1324","1356","1391","1463","1483",
    "1497","1528","1531","1539","1672","1693","1704","1874","1876","1900",
    "1914","2039","2049","2096","2100","2109","2169","2172","2183","2208",
    "2239","2243","2260","2269","2317","2362","2388","2470","2472","2488",
    "2527","2556","2602","2608","2613","2677","2680","2685","2727","2729",
    "2802","2811","2828","2877","2881","2932","2934","2993","2999","3044",
    "3066","3068","3111","3121","3153","3275","3298","3324","3369","3492",
    "3543","3554","3557","3561","3684","3689","3777","3793","3801","3815",
    "3839","3886","3997","4110","4137","4171","4227","4285","4332","4406",
    "4460","4462","4497","4501","4552","4577","4649","4650","4667","4732",
    "4794","4888","4892","4895","4912","4918","4998","5006","5075","5077",
    "5148","5169","5203","5232","5243","5287","5316","5357","5366","5395",
    "5397","5457","5472","5479","5496","5532","5568","5580","5659","5692",
    "5706","5737","5754","5805","5838","5847","5890","5909","5957","5983",
    "6015","6039","6047","6123","6224","6263","6266","6281","6291","6482",
    "6491","6502","6516","6566","6567","6583","6619","6629","6646","6680",
    "6722","6730","6741","6788"
]

with h5py.File(index_file, "r") as f:
    subjects_in_file = list(f["subjects"].keys())

print(f"총 subjects 수: {len(subjects_in_file)}")

# 교집합 / 차집합
present = [s for s in SLEEPPPG_TEST_SUBJECTS if s in subjects_in_file]
missing = [s for s in SLEEPPPG_TEST_SUBJECTS if s not in subjects_in_file]

print(f"테스트셋 대상 총 {len(SLEEPPPG_TEST_SUBJECTS)}명")
print(f" → index_file에 존재: {len(present)}명")
print(f" → index_file에 없음: {len(missing)}명")

if missing:
    print("누락된 subject IDs:", missing)
